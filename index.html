<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
        }
        button {
            background-color: #0088cc;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background-color: #0066aa;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <h2>üìç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</h2>
    <div id="status">–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç...</div>
    <button id="getLocationBtn" onclick="getLocation()" style="display:none;">–ü–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
    <button id="sendBtn" onclick="sendLocationToBot()" style="display:none;">‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç</button>

    <script>
        const statusDiv = document.getElementById('status');
        const getLocationBtn = document.getElementById('getLocationBtn');
        const sendBtn = document.getElementById('sendBtn');
        let userLocation = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        if (window.Telegram && window.Telegram.WebApp) {
            const webApp = window.Telegram.WebApp;
            webApp.ready();
            webApp.expand(); 
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
            getLocation();
        } else {
            statusDiv.innerHTML = '‚ùå –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ Telegram';
        }

        function getLocation() {
            statusDiv.innerHTML = 'üì° –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é...';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };
                        statusDiv.innerHTML = 
                            `‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ!<br>
                            üåç –®–∏—Ä–æ—Ç–∞: ${userLocation.latitude.toFixed(6)}<br>
                            üåç –î–æ–ª–≥–æ—Ç–∞: ${userLocation.longitude.toFixed(6)}`;
                        sendBtn.style.display = 'inline-block';
                    },
                    function(error) {
                        console.error('Geolocation error:', error);
                        statusDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'}`;
                        getLocationBtn.style.display = 'inline-block';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                statusDiv.innerHTML = '‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º';
                getLocationBtn.style.display = 'inline-block';
            }
        }

        function sendLocationToBot() {
            if (userLocation && window.Telegram && window.Telegram.WebApp) {
                try {
                    const webApp = window.Telegram.WebApp;
                    
                    webApp.sendData(JSON.stringify(userLocation));
                    
                    sendBtn.innerHTML = '‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!';
                    sendBtn.disabled = true;
                    statusDiv.innerHTML += '<br><br>‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –±–æ—Ç!';
                    
                } catch (error) {
                    console.error('Send data error:', error);
                    statusDiv.innerHTML += '<br>‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + error.message;
                }
            } else {
                statusDiv.innerHTML += '<br>‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏';
            }
        }
    </script>
</body>
</html>
