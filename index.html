<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
        }
        button {
            background-color: #0088cc;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-weight: bold;
        }
        button:hover {
            background-color: #0066aa;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #status {
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h2>üìç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</h2>
    <div id="status">–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç...</div>
    <button id="sendBtn" onclick="sendLocationToBot()" style="display:none;">‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç</button>

    <script>
        const statusDiv = document.getElementById('status');
        const sendBtn = document.getElementById('sendBtn');
        let userLocation = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        if (window.Telegram && window.Telegram.WebApp) {
            const webApp = window.Telegram.WebApp;
            webApp.ready();
            webApp.expand();
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
            getLocation();
        } else {
            statusDiv.innerHTML = '‚ùå –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ Telegram';
            statusDiv.className = 'error';
        }

        function getLocation() {
            statusDiv.innerHTML = 'üì° –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é...';
            statusDiv.className = '';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };
                        statusDiv.innerHTML = 
                            `‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ!<br><br>
                            üåç –®–∏—Ä–æ—Ç–∞: ${userLocation.latitude.toFixed(6)}<br>
                            üåç –î–æ–ª–≥–æ—Ç–∞: ${userLocation.longitude.toFixed(6)}`;
                        statusDiv.className = 'success';
                        sendBtn.style.display = 'inline-block';
                    },
                    function(error) {
                        console.error('Geolocation error:', error);
                        statusDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'}<br><br>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.`;
                        statusDiv.className = 'error';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 15000,
                        maximumAge: 0
                    }
                );
            } else {
                statusDiv.innerHTML = '‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º';
                statusDiv.className = 'error';
            }
        }

        function sendLocationToBot() {
            if (userLocation && window.Telegram && window.Telegram.WebApp) {
                try {
                    const webApp = window.Telegram.WebApp;
                    const data = JSON.stringify(userLocation);
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º postEvent –≤–º–µ—Å—Ç–æ sendData
                    if (webApp.version >= '6.0') {
                        webApp.postEvent('web_app_data_send', {data: data});
                    } else {
                        webApp.sendData(data);
                    }
                    
                    // –ú–µ–Ω—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
                    sendBtn.innerHTML = '‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!';
                    sendBtn.disabled = true;
                    statusDiv.innerHTML += '<br><br>‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –±–æ—Ç!';
                    statusDiv.className = 'success';
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        if (webApp.close) {
                            webApp.close();
                        }
                    }, 2000);
                    
                } catch (error) {
                    console.error('Send data error:', error);
                    statusDiv.innerHTML += '<br><br>‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + error.message;
                    statusDiv.className = 'error';
                }
            } else {
                statusDiv.innerHTML += '<br><br>‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏';
                statusDiv.className = 'error';
            }
        }
    </script>
</body>
</html>
